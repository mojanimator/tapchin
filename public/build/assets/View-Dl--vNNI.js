import{S as B}from"./Scaffold-D_ifbLkl.js";import{_ as F}from"./SecondaryButton-Bn4R_gjB.js";import{_ as V}from"./PrimaryButton-Fk5jf8Nh.js";import{j as T,i as l,o as r,c as h,w as _,e as n,t,f as d,a as s,b as c,g as x,k as w,A as j,n as S,p as z,h as N,F as E,v as D}from"./app-DeJr7fNP.js";import{L as M}from"./LoadingIcon-8dx7WYGr.js";import{I as H}from"./Footer-BYUJXMx0.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as $,a as O,b as Z}from"./UserIcon-0EqPaU23.js";import{r as A}from"./PlayIcon-CGUysmnM.js";import{r as W}from"./PauseIcon-DZ4vp-XW.js";import"./Alert-CDDSmLjy.js";import"./ApplicationLogo-CV6pwTdm.js";const Y={data(){return{html:null,stop:!1,timer:0,timerPercent:0,auto_view:this.$page.props.auto_view,error:null,data:null,available_sites:0,hiddenProp:null,intervalId:null,sites:[],loading:!1,params:{page:0,search:null,order_by:null,dir:null}}},components:{Scaffold:B,Image:H,Link:T,EyeIcon:$,CurrencyDollarIcon:O,LoadingIcon:M,PrimaryButton:V,SecondaryButton:F,UserIcon:Z,PlayIcon:A,PauseIcon:W},beforeUnmount(){clearInterval(this.intervalId)},created(){window.addEventListener("beforeunload",()=>{clearInterval(this.intervalId)})},mounted(){this.hiddenProp=this.getHiddenProp(),this.$page.props.error_message||this.isLoading(!0),this.data=this.$page.props.data,this.available_sites=this.$page.props.available_sites,this.setScroll(this.$refs.loader.$el),this.getData()},methods:{startTimer(e){this.isLoading(!1),this.timer=0,e.target;let a=this.$page.props.reward_second;this.intervalId=setInterval((function(){!this.tabIsVisible()&&!this.stop&&(this.timer++,this.timerPercent=Math.floor(this.timer/a*100)),this.timer>=a&&(clearInterval(this.intervalId),this.addTransaction())}).bind(this),1e3)},addTransaction(){this.$page.props.data&&(this.isLoading(!0),window.axios.post(route("transaction.site.view"),{id:this.$page.props.data.id,auto_view:this.auto_view}).then(e=>{this.isLoading(!1),e.data&&e.data.message&&(this.showToast("success",e.data.message),this.sleep(3e3).then(()=>{e.data.next&&this.auto_view&&this.$inertia.visit(route("site",e.data.next),{method:"get"})}))}).catch(e=>{this.isLoading(!1),this.error=this.getErrors(e),this.showToast("danger",this.error),e.response&&e.response.data&&this.sleep(3e3).then(()=>{e.response.data.next&&this.auto_view&&this.$inertia.visit(route("site",e.response.data.next),{method:"get"})})}).finally(()=>{this.isLoading(!1)}))},tabIsVisible(){const e=this.hiddenProp;return e?document[e]:!1},getHiddenProp(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var a=0;a<e.length;a++)if(e[a]+"Hidden"in document)return e[a]+"Hidden";return null},getData(){this.total>0&&this.total<=this.sites.length||(this.loading=!0,window.axios.get(route("site.search"),{params:this.params}).then(e=>{this.sites=this.sites.concat(e.data.data),this.total=e.data.total,this.params.page=e.data.current_page+1}).catch(e=>{this.error=this.getErrors(e),this.showToast("danger",this.error)}).finally(()=>{this.loading=!1}))},setScroll(e){window.onscroll=()=>{let a=e.offsetTop,f=e.offsetTop+e.offsetHeight,m=window.pageYOffset+window.innerHeight,o=window.pageYOffset;m+300>a&&o<f+200&&!this.loading&&this.getData()}}}},R={key:0},q=["content"];const G={class:"flex justify-center pt-24"},J={class:"w-full rounded-lg overflow-x-hidden shadow-lg max-w-6xl xs:mx-2 md:mx-4 blur-xs opacity-75 bg-white backdrop-filter"},K={key:0,class:"text-center flex flex-col font-bold p-4 text-danger text-lg"},Q={class:"text-gray-900"},X={key:1,class:"flex flex-col"},ee={class:"px-4 py-2 text-white bg-primary"},se={key:0,class:"border-t p-4 flex flex-col space-y-4 m-4"},te={key:0,class:"text-sm flex flex-wrap"},oe={class:"text-gray-500"},ae=s("span",{class:"border-s mx-2"},null,-1),re={class:"text-gray-500"},ie={class:"text-sm"},ne={class:"text-gray-500"},le={class:"text-sm"},ce={class:"text-gray-500"},de={class:"flex flex-wrap sm:flex-nowrap items-center justify-between text-white bg-primary px-4 py-2"},_e={class:"flex flex-wrap w-full justify-start items-center text-sm"},he={class:"flex items-center"},pe={class:"px-1"},fe={class:"px-1"},me=s("div",{class:"border-s py-4 md:mx-6 mx-1"},null,-1),ue={class:"flex items-center"},ge={class:"px-1"},xe={class:"px-1"},we=s("div",{class:"border-s py-4 md:mx-6 mx-1"},null,-1),ve={key:0,class:"flex items-center"},be={class:"px-1"},ye={class:"px-1"},ke={key:1,class:"flex items-center"},Ce={class:"px-1"},Ie={class:"px-1"},Pe=s("div",{class:"border-s py-4 md:mx-6 mx-1"},null,-1),Le={class:"flex items-center",dir:"ltr"},Be={class:"inline-block px-2 hover:cursor-pointer",for:"auto_view"},Fe={class:"text-primary-500 bg-primary-100 rounded-lg p-2 justify-center flex text-xs"},Ve={class:"mx-1"},Te={class:"mx-1"},je={class:"flex"},Se={class:"shadow w-full bg-grey-light m-2 bg-gray-200 rounded-full"},ze={class:"animate-bounce"},Ne=["src"],Ee={class:"w-full px-3 my-8 flex items-center justify-center"},De={class:"flex justify-center p-5 max-w-7xl mx-auto border-t mt-5"},Me={class:"grid sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-2 max-w-6xl"},He={class:"p-2 text-gray-700"},Ue={class:"px-4 py-2 text-sm text-gray-400"},$e=s("hr",{class:"border-gray-200"},null,-1),Oe={class:"flex justify-around items-center p-4 text-sm text-gray-500"},Ze={class:"flex items-center"},Ae={class:"px-1"},We={class:"px-1"},Ye=s("div",{class:"border-s py-2"},null,-1),Re={key:0,class:"flex items-center"},qe={class:"px-1"},Ge={class:"px-1"},Je={key:1,class:"flex items-center"},Ke={class:"px-1"},Qe={class:"px-1"};function Xe(e,a,f,m,o,p){const u=l("Link"),v=l("EyeIcon"),b=l("UserIcon"),g=l("CurrencyDollarIcon"),y=l("PlayIcon"),k=l("PauseIcon"),C=l("PrimaryButton"),I=l("Image"),P=l("LoadingIcon"),L=l("Scaffold");return r(),h(L,{"navbar-theme":"light"},{header:_(()=>[o.data?(r(),n("title",R,t(o.data.name),1)):d("",!0),o.data?(r(),n("meta",{key:1,name:"description",content:o.data.description},null,8,q)):d("",!0)]),default:_(()=>[d("",!0),s("section",G,[s("div",J,[e.$page.props.error_message?(r(),n("div",K,[s("div",Q,t(e.$page.props.error_message),1),c(u,{href:e.$page.props.error_link,class:"my-4"},{default:_(()=>[x(t(e.__("return")),1)]),_:1},8,["href"])])):o.data?(r(),n("div",X,[s("div",ee,t(o.data.name),1),o.data?(r(),n("div",se,[o.data.owner?(r(),n("p",te,[s("span",oe,t(e.__("owner"))+": ",1),s("span",null,t(o.data.owner.fullname),1),ae,s("span",re,t(e.__("phone"))+": ",1),s("span",null,t(o.data.owner.phone),1)])):d("",!0),s("p",ie,[s("span",ne,t(e.__("tags"))+": ",1),s("span",null,t(o.data.tags),1)]),s("p",le,[s("span",ce,t(e.__("description"))+": ",1),s("span",null,t(o.data.description),1)])])):d("",!0),s("div",de,[s("div",_e,[s("div",he,[c(v,{class:"w-4 h-4"}),s("span",pe,t(e.__("view"))+":",1),s("span",fe,t(o.data.view),1)]),me,s("div",ue,[c(b,{class:"w-4 h-4"}),s("span",ge,t(e.__("viewer"))+":",1),s("span",xe,t(o.data.viewer),1)]),we,e.hasWallet()?(r(),n("div",ke,[c(g,{class:"w-4 h-4"}),s("span",Ce,t(e.__("reward"))+":",1),s("span",Ie,t(e.asPrice(o.data.view_reward))+" "+t(e.__("currency_symbol")),1)])):(r(),n("div",ve,[c(g,{class:"w-4 h-4"}),s("span",be,t(e.__("reward"))+":",1),s("span",ye,t(e.$page.props.site_view_meta_reward)+" "+t(e.__("meta")),1)])),Pe,s("div",Le,[w(s("input",{"onUpdate:modelValue":a[0]||(a[0]=i=>o.auto_view=i),onChange:a[1]||(a[1]=i=>o.auto_view&&o.timer>=e.$page.props.reward_second?p.startTimer(e.$refs.iframe):null),class:"mx-2 h-3.5 w-8 appearance-none rounded-[0.4375rem] bg-neutral-300 before:pointer-events-none before:absolute before:h-3.5 before:w-3.5 before:rounded-full before:bg-transparent before:content-[''] after:absolute after:z-[2] after:-mt-[0.1975rem] after:h-5 after:w-5 after:rounded-full after:border-none after:bg-neutral-100 after:shadow-[0_0px_3px_0_rgb(0_0_0_/_7%),_0_2px_2px_0_rgb(0_0_0_/_4%)] after:transition-[background-color_0.2s,transform_0.2s] after:content-[''] checked:bg-success checked:after:absolute checked:after:z-[2] checked:after:-mt-[3px] checked:after:ml-[1.0625rem] checked:after:h-5 checked:after:w-5 checked:after:rounded-full checked:after:border-none checked:after:bg-success checked:after:shadow-[0_3px_1px_-2px_rgba(0,0,0,0.2),_0_2px_2px_0_rgba(0,0,0,0.14),_0_1px_5px_0_rgba(0,0,0,0.12)] checked:after:transition-[background-color_0.2s,transform_0.2s] checked:after:content-[''] hover:cursor-pointer focus:outline-none focus:ring-0 focus:before:scale-100 focus:before:opacity-[0.12] focus:before:shadow-[3px_-1px_0px_13px_rgba(0,0,0,0.6)] focus:before:transition-[box-shadow_0.2s,transform_0.2s] focus:after:absolute focus:after:z-[1] focus:after:block focus:after:h-5 focus:after:w-5 focus:after:rounded-full focus:after:content-[''] checked:focus:border-success checked:focus:bg-success checked:focus:before:ml-[1.0625rem] checked:focus:before:scale-100 checked:focus:before:shadow-[3px_-1px_0px_13px_#3b71ca] checked:focus:before:transition-[box-shadow_0.2s,transform_0.2s]",type:"checkbox",role:"switch",id:"auto_view"},null,544),[[j,o.auto_view]]),s("label",Be,t(e.__("auto_view")),1)]),s("div",null,[s("div",{onClick:a[2]||(a[2]=i=>o.stop=!o.stop),class:"rounded-full p-1 mx-1 border cursor-pointer hover:bg-gray-400"},[o.stop?(r(),h(y,{key:0,class:"w-5 h-5"})):(r(),h(k,{key:1,class:"w-5 h-5"}))])])]),s("div",Fe,[s("span",Ve,t(e.__("viewable"))+":",1),s("span",Te,t(o.available_sites>0?o.available_sites-1:0),1)])]),s("div",je,[s("div",Se,[s("div",{class:S(["bg-primary rounded text-xs leading-none py-[.1rem] text-center text-white duration-300",{" animate-pulse":o.timerPercent<100}]),style:z(`width: ${o.timerPercent}%`)},[s("span",ze,t(o.timer),1)],6)])]),s("iframe",{ref:"iframe",class:"w-full min-h-[24rem]",src:e.$page.props.data.link,onLoadOnce:a[3]||(a[3]=(...i)=>p.startTimer&&p.startTimer(...i))},`\r
\r
          `,40,Ne)])):d("",!0)])]),s("section",null,[s("div",Ee,[c(C,{onClick:a[4]||(a[4]=i=>e.$inertia.visit(e.route(e.$page.props.auth.user?"panel.site.create":"site.new"))),class:"mx-2 py-2 px-6"},{default:_(()=>[x(t(e.__("register_site")),1)]),_:1})])]),s("section",De,[s("div",Me,[(r(!0),n(E,null,N(o.sites,(i,es)=>(r(),h(u,{href:e.route("site",i.id),class:"flex-col items-stretch cursor-pointer hover:scale-[101%] duration-300 rounded-lg overflow-hidden shadow-lg"},{default:_(()=>[c(I,{src:e.route("storage.sites")+`/${i.id}.jpg`,classes:"object-cover h-48 rounded-lg  w-full"},null,8,["src"]),s("div",He,t(e.cropText(i.name,30)),1),s("div",Ue,t(e.getCategory(i.category_id)),1),$e,s("div",Oe,[s("div",Ze,[s("span",Ae,t(e.__("view"))+":",1),s("span",We,t(i.view),1)]),Ye,e.hasWallet()?(r(),n("div",Je,[s("span",Ke,t(e.__("reward"))+":",1),s("span",Qe,t(e.asPrice(i.view_fee))+" "+t(e.__("currency_symbol")),1)])):(r(),n("div",Re,[s("span",qe,t(e.__("reward"))+":",1),s("span",Ge,t(e.$page.props.site_view_meta_reward)+" "+t(e.__("meta")),1)]))])]),_:2},1032,["href"]))),256))])]),w(c(P,{ref:"loader",type:"linear"},null,512),[[D,o.loading]])]),_:1})}const ps=U(Y,[["render",Xe]]);export{ps as default};
